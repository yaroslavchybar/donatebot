{
  "version": 3,
  "sources": ["../../../../src/cli/lib/indexes.ts"],
  "sourcesContent": ["import { chalkStderr } from \"chalk\";\nimport { deploymentDashboardUrlPage } from \"./dashboard.js\";\nimport { DeveloperIndexConfig } from \"./deployApi/finishPush.js\";\n\nexport type IndexMetadata = {\n  table: string;\n  name: string;\n  fields:\n    | string[]\n    | {\n        searchField: string;\n        filterFields: string[];\n      }\n    | {\n        dimensions: number;\n        vectorField: string;\n        filterFields: string[];\n      };\n  backfill: {\n    state: \"in_progress\" | \"done\";\n  };\n  staged: boolean;\n};\n\nexport type LargeIndexDeletionCheck =\n  // Don\u2019t verify whether large indexes have been deleted\n  | \"no verification\"\n  // If large indexes are being deleted, ask for confirmation (and fail in non-interactive envs)\n  | \"ask for confirmation\"\n  // If large indexes are being deleted, confirm (the user has used --allow-deleting-large-indexes)\n  | \"has confirmation\";\n\nexport function addProgressLinkIfSlow(\n  msg: string,\n  deploymentName: string | null,\n  start: number,\n): string {\n  if (Date.now() - start > 10_000) {\n    const dashboardUrl = deploymentDashboardUrlPage(\n      deploymentName,\n      `/data?showSchema=true`,\n    );\n    msg = msg.concat(`\\nSee progress here: ${dashboardUrl}`);\n  }\n  return msg;\n}\n\nexport function formatIndex(index: DeveloperIndexConfig) {\n  const [tableName, indexName] = index.name.split(\".\");\n  return `${tableName}.${chalkStderr.bold(indexName)} ${chalkStderr.gray(formatIndexFields(index))}${index.staged ? chalkStderr.blue(\"  (staged)\") : \"\"}`;\n}\n\nfunction formatIndexFields(index: DeveloperIndexConfig) {\n  switch (index.type) {\n    case \"database\":\n      return (\n        \"  \" + index.fields.map((f) => chalkStderr.underline(f)).join(\", \")\n      );\n    case \"search\":\n      return `${chalkStderr.cyan(\"(text)\")}   ${chalkStderr.underline(index.searchField)}${formatFilterFields(index.filterFields)}`;\n    case \"vector\":\n      return `${chalkStderr.cyan(\"(vector)\")}   ${chalkStderr.underline(index.vectorField)} (${index.dimensions} dimensions)${formatFilterFields(index.filterFields)}`;\n    default:\n      index satisfies never;\n      return \"\";\n  }\n}\n\nfunction formatFilterFields(filterFields: string[]) {\n  if (filterFields.length === 0) {\n    return \"\";\n  }\n  return `, filter${filterFields.length === 1 ? \"\" : \"s\"} on ${filterFields.map((f) => chalkStderr.underline(f)).join(\", \")}`;\n}\n"],
  "mappings": ";AAAA,SAAS,mBAAmB;AAC5B,SAAS,kCAAkC;AA+BpC,gBAAS,sBACd,KACA,gBACA,OACQ;AACR,MAAI,KAAK,IAAI,IAAI,QAAQ,KAAQ;AAC/B,UAAM,eAAe;AAAA,MACnB;AAAA,MACA;AAAA,IACF;AACA,UAAM,IAAI,OAAO;AAAA,qBAAwB,YAAY,EAAE;AAAA,EACzD;AACA,SAAO;AACT;AAEO,gBAAS,YAAY,OAA6B;AACvD,QAAM,CAAC,WAAW,SAAS,IAAI,MAAM,KAAK,MAAM,GAAG;AACnD,SAAO,GAAG,SAAS,IAAI,YAAY,KAAK,SAAS,CAAC,IAAI,YAAY,KAAK,kBAAkB,KAAK,CAAC,CAAC,GAAG,MAAM,SAAS,YAAY,KAAK,YAAY,IAAI,EAAE;AACvJ;AAEA,SAAS,kBAAkB,OAA6B;AACtD,UAAQ,MAAM,MAAM;AAAA,IAClB,KAAK;AACH,aACE,OAAO,MAAM,OAAO,IAAI,CAAC,MAAM,YAAY,UAAU,CAAC,CAAC,EAAE,KAAK,IAAI;AAAA,IAEtE,KAAK;AACH,aAAO,GAAG,YAAY,KAAK,QAAQ,CAAC,MAAM,YAAY,UAAU,MAAM,WAAW,CAAC,GAAG,mBAAmB,MAAM,YAAY,CAAC;AAAA,IAC7H,KAAK;AACH,aAAO,GAAG,YAAY,KAAK,UAAU,CAAC,MAAM,YAAY,UAAU,MAAM,WAAW,CAAC,KAAK,MAAM,UAAU,eAAe,mBAAmB,MAAM,YAAY,CAAC;AAAA,IAChK;AACE;AACA,aAAO;AAAA,EACX;AACF;AAEA,SAAS,mBAAmB,cAAwB;AAClD,MAAI,aAAa,WAAW,GAAG;AAC7B,WAAO;AAAA,EACT;AACA,SAAO,WAAW,aAAa,WAAW,IAAI,KAAK,GAAG,OAAO,aAAa,IAAI,CAAC,MAAM,YAAY,UAAU,CAAC,CAAC,EAAE,KAAK,IAAI,CAAC;AAC3H;",
  "names": []
}
